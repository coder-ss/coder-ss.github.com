<!doctype html>



  


<html class="theme-next mist use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="机器学习,朴素贝叶斯," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.png?v=5.0.2" />






<meta name="description" content="这篇笔记先对生成式学习方法和判别式学习方法做了介绍，然后介绍了朴素贝叶斯假设，之后介绍了朴素贝叶斯假设在二分类问题上的应用和拉普拉斯平滑，最后对垃圾邮件分类问题基于Python进行了实践。">
<meta property="og:type" content="article">
<meta property="og:title" content="机器学习之朴素贝叶斯">
<meta property="og:url" content="http://coder-ss.github.io/2016/12/06/machine_learning/naive-bayes/index.html">
<meta property="og:site_name" content="coder_ss's blog">
<meta property="og:description" content="这篇笔记先对生成式学习方法和判别式学习方法做了介绍，然后介绍了朴素贝叶斯假设，之后介绍了朴素贝叶斯假设在二分类问题上的应用和拉普拉斯平滑，最后对垃圾邮件分类问题基于Python进行了实践。">
<meta property="og:updated_time" content="2017-02-23T16:16:38.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="机器学习之朴素贝叶斯">
<meta name="twitter:description" content="这篇笔记先对生成式学习方法和判别式学习方法做了介绍，然后介绍了朴素贝叶斯假设，之后介绍了朴素贝叶斯假设在二分类问题上的应用和拉普拉斯平滑，最后对垃圾邮件分类问题基于Python进行了实践。">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    }
  };
</script>




  <link rel="canonical" href="http://coder-ss.github.io/2016/12/06/machine_learning/naive-bayes/"/>


  <title> 机器学习之朴素贝叶斯 | coder_ss's blog </title>
</head>

<body itemscope itemtype="//schema.org/WebPage" lang="zh-Hans">

  



  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?7d7157a5836d43e3ad7dbd42e82697f3";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>








  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="//schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">coder_ss's blog</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">do something interesting</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                机器学习之朴素贝叶斯
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-12-06T17:22:00+08:00" content="2016-12-06">
              2016-12-06
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/machine-learning/" itemprop="url" rel="index">
                    <span itemprop="name">machine_learning</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/12/06/machine_learning/naive-bayes/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/12/06/machine_learning/naive-bayes/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="生成式与判别式"><a href="#生成式与判别式" class="headerlink" title="生成式与判别式"></a>生成式与判别式</h2><p>监督学习的任务就是要学习到一个模型，对于给定一个输入 $\boldsymbol{x} = \left[ \begin{matrix} x_1 &amp; x_2 &amp; \cdots &amp; x_n \end{matrix} \right]^{\text{T}} $，能够预测其输出 $y$。这个模型一般形式为决策函数：</p>
<script type="math/tex; mode=display">y = h_\boldsymbol{\theta}\left(\boldsymbol{x}\right)</script><p>或者条件分布概率：</p>
<script type="math/tex; mode=display">p\left(y\mid\boldsymbol{x}\right)</script><p><strong>判别式学习方法</strong>（discriminative learning algorithms）由数据直接学习到决策函数 $h_\boldsymbol{\theta}\left(\boldsymbol{x}\right) $ 或者条件概率 $p\left(y\mid\boldsymbol{x}\right)$ 分布作为预测的模型。</p>
<p><strong>生成式学习方法</strong>（generative learning algorithms）则是对条件概率 $p\left(\boldsymbol{x}\mid y\right)$（和概率 $p\left(y\right)$）建模，然后依据贝叶斯公式可以计算出给定 $\boldsymbol{x}$ 下 $y$ 的概率：</p>
<script type="math/tex; mode=display">p\left(y\mid \boldsymbol{x}\right) = \frac{p\left(\boldsymbol{x}\mid y\right)p\left(y\right)}{p\left(\boldsymbol{x}\right)}</script><p>上式中 $p\left( \boldsymbol{x} \right)$ 可以求解出来，例如对于二分类问题：</p>
<script type="math/tex; mode=display">p\left(\boldsymbol{x}\right) = p\left(\boldsymbol{x}\mid y=1\right)p\left(y=1\right) + p\left(\boldsymbol{x}\mid y=0\right)p\left(y=0\right)</script><p>事实上，对于预测问题，我们可以不用求解出 $p\left( \boldsymbol{x} \right)$：</p>
<script type="math/tex; mode=display">\begin{align*}
\arg \max_y p\left(y\mid \boldsymbol{x}\right) &= \arg \max_y \frac{p\left( \boldsymbol{x}\mid y \right)p\left(y\right)}{p\left( \boldsymbol{x} \right)} \\ 
&= \arg \max_y p\left( \boldsymbol{x}\mid y \right)p\left(y\right)
\end{align*}</script><p>生成式学习方法特点：</p>
<ul>
<li>可以还原出联合概率分布 $p\left( \boldsymbol{x}, y \right) = p\left( \boldsymbol{x}\mid y \right)p\left( y \right)$</li>
<li>收敛速度更快，当样本容量增加时，学到的模型可以更快地收敛于真实模型</li>
<li>存在隐变量时，仍然可以用生成式学习方法，此时判别式学习方法就不能用</li>
</ul>
<p>判别式学习方法特点：</p>
<ul>
<li>直接面对预测，往往学习的准确率更高</li>
<li>可以对数据进行各种程度上的抽象、定义特征并使用特征，因此可以简化学习问题</li>
</ul>
<h2 id="朴素贝叶斯"><a href="#朴素贝叶斯" class="headerlink" title="朴素贝叶斯"></a>朴素贝叶斯</h2><p>上面介绍生成式算法时我们已经利用贝叶斯公式建立了 $p\left( y\mid \boldsymbol{x} \right)$ 与 $p\left( \boldsymbol{x}\mid y \right)$ 的关系，为了方便求解 $p\left( \boldsymbol{x}\mid y \right)$，我们假设 $x_i$ 在给定 $y$ 的条件下是独立的，这个假设称为<strong>贝叶斯假设</strong>（Naive Bayes assumption），也叫<strong>属性条件独立性假设</strong>（attribute conditional independence assumption）。</p>
<p>通过朴素贝叶斯假设我们可以简化 $p\left( \boldsymbol{x}\mid y \right)$ 的计算：</p>
<script type="math/tex; mode=display">\begin{align*} 
p\left( \boldsymbol{x} \mid y \right) &= p\left( x_1, x_2, \ldots, x_n \mid y \right) \\ 
&= p\left( x_1 \mid y \right) p\left( x_2 \mid y, x_1 \right) \cdots p\left( x_n \mid y, x_1, x_2, \ldots, x_{n-1} \right) \\
&= p\left( x_1 \mid y \right) p\left( x_2 \mid y \right) \cdots p\left( x_n \mid y \right) \\
&= \prod_{i=1}^{n} p\left( x_i \mid y \right)
\end{align*}</script><p>上述推导中的第二行到第三行用到了朴素贝叶斯假设。</p>
<p>考虑垃圾邮件识别问题，假定一封垃圾邮件样本中出现了“买”、“价格”两个词，朴素贝叶斯假设的意思是：就算知道“买”已经出现在了这封邮件中，也对“价格”是否出现在这封邮件中没有影响。显然这个假设不太科学，但在实际中效果却非常好。</p>
<h3 id="词集模型"><a href="#词集模型" class="headerlink" title="词集模型"></a>词集模型</h3><p>对于垃圾邮件识别问题（或类似的文本处理问题），一个很常用的方式是用一个特征向量来表示一封电子邮件，特征向量的长度是词库的大小。如果一封邮件中包含词库中的第i个单词，就设置 $x_i = 1$，对于邮件中没有出现过的单词，全部设置为0。例如，向量</p>
<script type="math/tex; mode=display">\begin{align*} \boldsymbol{x} = \left[ \begin{matrix} 1 \\ 0  \\ 0 \\ \vdots \\ 1 \\ \vdots \\ 0 \end{matrix} \right] \quad \begin{matrix} \text{a} \\  \text{aardvark} \\ \text{aardwolf} \\ \vdots \\ \text{buy} \\ \vdots \\ \text{zygmurgy} \end{matrix} \end{align*}</script><p>表示该邮件中包含了“a”、“buy”，而不包含“aardvark”、“aardwolf”、“zygmurgy”。实际中，一般不会使用整个词库作为特征向量，而是只使用训练样本中出现了的词（去掉停用词），从而降低特征向量的维度、减小存储空间和计算量。</p>
<p>上述特征向量只考虑了单词在邮件中出现与否，而没有考虑每个单词在该邮件中出现的次数，称为<strong>词集模型</strong>。相应地，<strong>词袋模型</strong>会考虑每个单词在该邮件中出现的次数。</p>
<h3 id="模型求解"><a href="#模型求解" class="headerlink" title="模型求解"></a>模型求解</h3><p>对于垃圾邮件的识别，我们希望估计在给定邮件的情况下，邮件为垃圾邮件的概率：</p>
<script type="math/tex; mode=display">p \left( y=1 \mid \boldsymbol{x} \right) = \frac{p\left( \boldsymbol{x} \mid y=1 \right) p\left( y=1 \right)}{p\left( \boldsymbol{x} \right)}</script><p>根据贝叶斯假设，有</p>
<script type="math/tex; mode=display">\begin{align*}
p \left( y=1 \mid \boldsymbol{x} \right) &= \frac{p\left( \boldsymbol{x} \mid y=1 \right) p\left( y=1 \right)}{p\left( \boldsymbol{x} \right)} \\ 
&= \frac{\left( \prod \limits_{i=1}^{n} p\left( x_i \mid y=1 \right) \right) p\left( y=1 \right)} {\left( \prod \limits_{i=1}^{n} p\left( x_i \mid y=1 \right) \right) p\left( y=1 \right) + \left( \prod \limits_{i=1}^{n} p\left( x_i \mid y=0 \right) \right) p\left( y=0 \right)}
\end{align*}</script><p>显然，我们需要对 $p\left( x_i \mid y=1 \right)$、$p\left( x_i \mid y=0 \right)$、$p\left( y \right)$ 建模。</p>
<p>对于包含m个样本的样本集，我们可以统计出如下概率进而求解上式：</p>
<ol>
<li>垃圾邮件中词 $x_i$ 出现的概率<script type="math/tex; mode=display">p \left( x_i =1 \mid y=1 \right) = \frac{\sum \limits_{j=1}^{m} 1 \left\{ x_{i}^{(j)}=1 \wedge y^{(j)} = 1 \right\}}{\sum \limits_{j=1}^{m} 1 \left\{ y^{(j)} = 1 \right\} }</script></li>
<li>正常邮件中词 $x_i$ 出现的概率<script type="math/tex; mode=display">p \left( x_i =1 \mid y=0 \right) = \frac{\sum \limits_{j=1}^{m} 1 \left\{ x_{i}^{(j)}=1 \wedge y^{(j)} = 0 \right\}}{\sum \limits_{j=1}^{m} 1 \left\{ y^{(j)} = 0 \right\} }</script></li>
<li>垃圾邮件所占的比率<script type="math/tex; mode=display">p \left( y=1 \right) = \frac{\sum \limits_{j=1}^{m} 1\left\{ y^{(j)} = 1 \right\}}{m}</script></li>
</ol>
<p>其中，$\boldsymbol{x}^{(j)}$、$y^{(j)}$ 表示第j封邮件的特征向量和标签，$x_i^{(j)}$ 表示第j封邮件中 $x_i$ 的值，$\wedge$ 表示“and”关系，$1 \left\lbrace \cdots \right\rbrace$ 是指示函数，当 $\cdots$ 为真时，指示函数的值为1，否则指示函数的值为0。</p>
<blockquote>
<p>这里说上面三个概率是根据样本被统计出来的，事实上，这种说法不太科学。样本统计出来的是样本的参数，而不是总体的参数。<br>对于总体参数估计（parameter estimation），统计学界的两个学派分别提供了不同的解决方案：</p>
<ol>
<li><strong>频率主义学派</strong>（Frequentist）认为参数虽然未知，但却是客观存在的固定值，因此，可以通过优化似然函数等准则来确定参数值；</li>
<li><strong>贝叶斯学派</strong>（Bayesian）则认为参数是未观察到的随机变量，其本身也可能有分布，因此，可假定参数服从一个先验分布，然后基于观测到的数据来计算参数的后验分布。</li>
</ol>
<p>对于上面三个概率，吴恩达老师给出了依据极大似然估计的推导，因为有个别地方没理解透彻，所以没有在上面进行解释，这里直接给出吴恩达老师的推导：<br>记 $\phi_{i \mid y=1} = p \left( x_i=1 \mid y=1 \right)$、$\phi_{i \mid y=0} = p \left( x_i=1 \mid y=0 \right)$、$\phi_{y}=p\left(y=1\right)$。对于m个训练样本 $\left( x^{(j)}, y^{(j)}; j=1,2,\ldots,m \right)$，极大似然函数为：</p>
<script type="math/tex; mode=display">L\left( \phi_{y}, \phi_{i \mid y=0}, \phi_{i \mid y=1} \right) = \prod_{j=1}^{m} p\left( x^{(j)}, y^{(j)} \right)</script><p>最大化上式就是对 $\phi_{y}$、$\phi_{i \mid y=0}$、$ \phi_{i \mid y=1}$进行极大似然估计</p>
<script type="math/tex; mode=display">\phi_{j \mid y=1} = \frac{\sum_{j=1}^{m} 1 \left\{ x_{i}^{(j)}=1 \wedge y^{(j)} = 1 \right\}}{\sum_{j=1}^{m} 1 \left\{ y^{(j)} = 1 \right\} }</script><script type="math/tex; mode=display">\phi_{j \mid y=0} = \frac{\sum_{j=1}^{m} 1 \left\{ x_{i}^{(j)}=1 \wedge y^{(j)} = 0 \right\}}{\sum_{j=1}^{m} 1 \left\{ y^{(j)} = 0 \right\} }</script><script type="math/tex; mode=display">\phi_{y} = \frac{\sum_{j=1}^{m} 1\left\{ y^{(j)} = 1 \right\}}{m}</script></blockquote>
<h2 id="拉普拉斯平滑"><a href="#拉普拉斯平滑" class="headerlink" title="拉普拉斯平滑"></a>拉普拉斯平滑</h2><p>假设现在有一封邮件需要判断是否是垃圾邮件，但邮件中有一个单词在样本中没有出现过。假设特征向量的长度为50000，而这个没有出现过的单词是第35000个单词，那么</p>
<script type="math/tex; mode=display">p\left( x_{35000} \mid y=1 \right) = \frac{\sum_{j=1}^{m} 1 \left\{ x_{35000}^{(j)} = 1 \wedge y^{(j=1)} = 1 \right\}}{ \sum_{j=1}^{m} 1 \left\{ y^{(j)} = 1 \right\} } = 0</script><script type="math/tex; mode=display">p\left( x_{35000} \mid y=0 \right) = \frac{\sum_{j=1}^{m} 1 \left\{ x_{35000}^{(j)} = 1 \wedge y^{(j=1)} = 0 \right\}}{ \sum_{j=1}^{m} 1 \left\{ y^{(j)} = 0 \right\} } = 0</script><p>所以，这封邮件是垃圾邮件的概率为</p>
<script type="math/tex; mode=display">\begin{align*}
p \left( y=1 \mid \boldsymbol{x} \right) 
&= \frac{\left( \prod \limits_{i=1}^{n} p\left( x_i \mid y=1 \right) \right) p\left( y=1 \right)} {\left( \prod \limits_{i=1}^{n} p\left( x_i \mid y=1 \right) \right) p\left( y=1 \right) + \left( \prod \limits_{i=1}^{n} p\left( x_i \mid y=0 \right) \right) p\left( y=0 \right)} \\
&= \frac{0}{0}
\end{align*}</script><p>因此，我们的模型在这种条件下的结果是没有意义的。</p>
<p>问题的根源在于我们仅仅因为有些单词在有限的训练集中没有出现过，就认为其在总体中出现的概率为0。</p>
<p>多项式随机变量z的取值是 $\left\lbrace 1,2,\ldots, k \right\rbrace$ ，有m个样本 $z^{(1)},\ldots,z^{(m)}$，那么</p>
<script type="math/tex; mode=display">p\left(z=j\right) = \frac{\sum_{i=1}^{m} 1 \left\{ z^{(i)}=j \right\}}{m}</script><p>显然，有些概率会等于0。用<strong>拉普拉斯平滑（Laplace smoothing）</strong>，将上面的概率替换为</p>
<script type="math/tex; mode=display">p\left(z=j\right) = \frac{\sum_{i=1}^{m} 1 \left\{ z^{(i)}=j \right\} + 1}{m + k}</script><p>这里分子加1，而分母加了k，保证总体的概率和是1，但是没有一个概率等于0。</p>
<p>对于 $p \left( x_i =1 \mid y=1 \right)$、$p \left( x_i =1 \mid y=0 \right)$，这里 $k=2$：</p>
<script type="math/tex; mode=display">p \left( x_i =1 \mid y=1 \right) = \frac{\sum \limits_{j=1}^{m} 1 \left\{ x_{i}^{(j)}=1 \wedge y^{(j)} = 1 \right\} + 1}{\sum \limits_{j=1}^{m} 1 \left\{ y^{(j)} = 1 \right\} + 2}</script><script type="math/tex; mode=display">p \left( x_i =1 \mid y=0 \right) = \frac{\sum \limits_{j=1}^{m} 1 \left\{ x_{i}^{(j)}=1 \wedge y^{(j)} = 0 \right\} + 1}{\sum \limits_{j=1}^{m} 1 \left\{ y^{(j)} = 0 \right\} + 2}</script><h2 id="实践"><a href="#实践" class="headerlink" title="实践"></a>实践</h2><p>对垃圾邮件识别问题进行了实践。代码和数据以ipython notebook的形式放在了<a href="https://github.com/coder-ss/ml-learn/tree/master/naive-bayes" target="_blank" rel="external">github</a>上。</p>
<p>一共有三份数据：</p>
<ul>
<li><a href="http://csmining.org/index.php/enron-spam-datasets.html" target="_blank" rel="external">enron_email</a></li>
<li><a href="http://csmining.org/index.php/ling-spam-datasets.html" target="_blank" rel="external">ling_email</a></li>
<li><a href="http://csmining.org/index.php/spam-email-datasets-.html" target="_blank" rel="external">CSDMC2010_email</a></li>
</ul>
<p>首先引入依赖项、构建停用词：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> os</div><div class="line"><span class="keyword">import</span> sys</div><div class="line"><span class="keyword">import</span> re</div><div class="line"><span class="keyword">import</span> random</div><div class="line"><span class="keyword">import</span> chardet</div><div class="line"></div><div class="line">stop_word_list = [<span class="string">"a"</span>,<span class="string">"about"</span>,<span class="string">"above"</span>,<span class="string">"after"</span>,<span class="string">"again"</span>,<span class="string">"against"</span>,<span class="string">"all"</span>,<span class="string">"am"</span>,<span class="string">"an"</span>,<span class="string">"and"</span>,<span class="string">"any"</span>,<span class="string">"are"</span>,<span class="string">"aren't"</span>,<span class="string">"as"</span>,<span class="string">"at"</span>,<span class="string">"be"</span>,<span class="string">"because"</span>,<span class="string">"been"</span>,<span class="string">"before"</span>,<span class="string">"being"</span>,<span class="string">"below"</span>,<span class="string">"between"</span>,<span class="string">"both"</span>,<span class="string">"but"</span>,<span class="string">"by"</span>,<span class="string">"can't"</span>,<span class="string">"cannot"</span>,<span class="string">"could"</span>,<span class="string">"couldn't"</span>,<span class="string">"did"</span>,<span class="string">"didn't"</span>,<span class="string">"do"</span>,<span class="string">"does"</span>,<span class="string">"doesn't"</span>,<span class="string">"doing"</span>,<span class="string">"don't"</span>,<span class="string">"down"</span>,<span class="string">"during"</span>,<span class="string">"each"</span>,<span class="string">"few"</span>,<span class="string">"for"</span>,<span class="string">"from"</span>,<span class="string">"further"</span>,<span class="string">"had"</span>,<span class="string">"hadn't"</span>,<span class="string">"has"</span>,<span class="string">"hasn't"</span>,<span class="string">"have"</span>,<span class="string">"haven't"</span>,<span class="string">"having"</span>,<span class="string">"he"</span>,<span class="string">"he'd"</span>,<span class="string">"he'll"</span>,<span class="string">"he's"</span>,<span class="string">"her"</span>,<span class="string">"here"</span>,<span class="string">"here's"</span>,<span class="string">"hers"</span>,<span class="string">"herself"</span>,<span class="string">"him"</span>,<span class="string">"himself"</span>,<span class="string">"his"</span>,<span class="string">"how"</span>,<span class="string">"how's"</span>,<span class="string">"i"</span>,<span class="string">"i'd"</span>,<span class="string">"i'll"</span>,<span class="string">"i'm"</span>,<span class="string">"i've"</span>,<span class="string">"if"</span>,<span class="string">"in"</span>,<span class="string">"into"</span>,<span class="string">"is"</span>,<span class="string">"isn't"</span>,<span class="string">"it"</span>,<span class="string">"it's"</span>,<span class="string">"its"</span>,<span class="string">"itself"</span>,<span class="string">"let's"</span>,<span class="string">"me"</span>,<span class="string">"more"</span>,<span class="string">"most"</span>,<span class="string">"mustn't"</span>,<span class="string">"my"</span>,<span class="string">"myself"</span>,<span class="string">"no"</span>,<span class="string">"nor"</span>,<span class="string">"not"</span>,<span class="string">"of"</span>,<span class="string">"off"</span>,<span class="string">"on"</span>,<span class="string">"once"</span>,<span class="string">"only"</span>,<span class="string">"or"</span>,<span class="string">"other"</span>,<span class="string">"ought"</span>,<span class="string">"our"</span>,<span class="string">"ours"</span>,<span class="string">"ourselves"</span>,<span class="string">"out"</span>,<span class="string">"over"</span>,<span class="string">"own"</span>,<span class="string">"same"</span>,<span class="string">"shan't"</span>,<span class="string">"she"</span>,<span class="string">"she'd"</span>,<span class="string">"she'll"</span>,<span class="string">"she's"</span>,<span class="string">"should"</span>,<span class="string">"shouldn't"</span>,<span class="string">"so"</span>,<span class="string">"some"</span>,<span class="string">"such"</span>,<span class="string">"than"</span>,<span class="string">"that"</span>,<span class="string">"that's"</span>,<span class="string">"the"</span>,<span class="string">"their"</span>,<span class="string">"theirs"</span>,<span class="string">"them"</span>,<span class="string">"themselves"</span>,<span class="string">"then"</span>,<span class="string">"there"</span>,<span class="string">"there's"</span>,<span class="string">"these"</span>,<span class="string">"they"</span>,<span class="string">"they'd"</span>,<span class="string">"they'll"</span>,<span class="string">"they're"</span>,<span class="string">"they've"</span>,<span class="string">"this"</span>,<span class="string">"those"</span>,<span class="string">"through"</span>,<span class="string">"to"</span>,<span class="string">"too"</span>,<span class="string">"under"</span>,<span class="string">"until"</span>,<span class="string">"up"</span>,<span class="string">"very"</span>,<span class="string">"was"</span>,<span class="string">"wasn't"</span>,<span class="string">"we"</span>,<span class="string">"we'd"</span>,<span class="string">"we'll"</span>,<span class="string">"we're"</span>,<span class="string">"we've"</span>,<span class="string">"were"</span>,<span class="string">"weren't"</span>,<span class="string">"what"</span>,<span class="string">"what's"</span>,<span class="string">"when"</span>,<span class="string">"when's"</span>,<span class="string">"where"</span>,<span class="string">"where's"</span>,<span class="string">"which"</span>,<span class="string">"while"</span>,<span class="string">"who"</span>,<span class="string">"who's"</span>,<span class="string">"whom"</span>,<span class="string">"why"</span>,<span class="string">"why's"</span>,<span class="string">"with"</span>,<span class="string">"won't"</span>,<span class="string">"would"</span>,<span class="string">"wouldn't"</span>,<span class="string">"you"</span>,<span class="string">"you'd"</span>,<span class="string">"you'll"</span>,<span class="string">"you're"</span>,<span class="string">"you've"</span>,<span class="string">"your"</span>,<span class="string">"yours"</span>,<span class="string">"yourself"</span>,<span class="string">"yourselves"</span>,<span class="string">"re"</span>,<span class="string">"subject"</span>]</div><div class="line"></div><div class="line">stop_words = dict(zip(stop_word_list, [<span class="number">1</span>] * len(stop_word_list)))</div></pre></td></tr></table></figure></p>
<p>为了后续调用方便，构建以下函数：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">extract_words</span><span class="params">(text, _stop_words)</span>:</span></div><div class="line">    <span class="string">""" 提取邮件中的单词（重复单词只提取一次）</span></div><div class="line"></div><div class="line">    :param text: 邮件正文</div><div class="line">    :param _stop_words: 停用词</div><div class="line">    :return: 单词列表</div><div class="line">    """</div><div class="line">    _words = re.findall(<span class="string">'[a-zA-Z\d]&#123;2,&#125;'</span>, text)</div><div class="line">    _word_set = []</div><div class="line">    <span class="keyword">for</span> w <span class="keyword">in</span> _words:</div><div class="line">        <span class="keyword">if</span> w <span class="keyword">in</span> _stop_words.keys() <span class="keyword">or</span> re.search(<span class="string">'\d'</span>, w):</div><div class="line">            <span class="keyword">continue</span></div><div class="line">        _word_set.append(w.lower())</div><div class="line">    _word_set = list(set(_word_set))</div><div class="line"></div><div class="line">    <span class="keyword">return</span> _word_set</div><div class="line">    </div><div class="line">    </div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">load_email</span><span class="params">(filename, _stop_words)</span>:</span></div><div class="line">    <span class="string">""" 根据文件名加载邮件</span></div><div class="line">    </div><div class="line">    :param filename: 文件名</div><div class="line">    :param _stop_words: 停用词</div><div class="line">    :return: 邮件（用一个单词列表表示）</div><div class="line">    """</div><div class="line">    <span class="keyword">with</span> open(filename, <span class="string">"rb"</span>) <span class="keyword">as</span> _fp:</div><div class="line">        ec = chardet.detect(_fp.read())[<span class="string">'encoding'</span>]</div><div class="line">    <span class="keyword">with</span> open(filename, <span class="string">"r"</span>, encoding=ec) <span class="keyword">as</span> _fp:</div><div class="line">        _email = extract_words(_fp.read(), _stop_words)</div><div class="line">    <span class="keyword">return</span> _email</div><div class="line"></div><div class="line">    </div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">load_data_set</span><span class="params">(data_name)</span>:</span></div><div class="line">    <span class="string">""" 加载数据</span></div><div class="line"></div><div class="line">    :param data_name: 数据名：enron_email, ling_bare_email, CSDMC2010_email</div><div class="line">    :return: 正常邮件集，垃圾邮件集</div><div class="line">    """</div><div class="line">    _emails_ham = &#123;&#125;; _emails_spam = &#123;&#125;</div><div class="line">    <span class="keyword">for</span> _fn <span class="keyword">in</span>  os.listdir(<span class="string">'./data/%s/ham'</span> % data_name):</div><div class="line">        <span class="keyword">if</span> _fn == <span class="string">'.DS_Store'</span>:</div><div class="line">            <span class="keyword">continue</span></div><div class="line"></div><div class="line">        _email_list = load_email(<span class="string">'./data/%s/ham/%s'</span> % (data_name, _fn), stop_words)</div><div class="line">        <span class="keyword">if</span> len(_email_list) &gt; <span class="number">5</span>:</div><div class="line">            _emails_ham[_fn] = _email_list</div><div class="line"></div><div class="line">    <span class="keyword">for</span> _fn <span class="keyword">in</span>  os.listdir(<span class="string">'./data/%s/spam'</span> % data_name):</div><div class="line">        <span class="keyword">if</span> _fn == <span class="string">'.DS_Store'</span>:</div><div class="line">            <span class="keyword">continue</span></div><div class="line"></div><div class="line">        _email_list = load_email(<span class="string">'./data/%s/spam/%s'</span> % (data_name, _fn), stop_words)</div><div class="line">        <span class="keyword">if</span> len(_email_list) &gt; <span class="number">5</span>:</div><div class="line">            _emails_spam[_fn] = _email_list</div><div class="line"></div><div class="line">    <span class="keyword">return</span> _emails_ham, _emails_spam</div></pre></td></tr></table></figure></p>
<p>加载enron_email数据<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 加载enron_email数据（较慢，可能需要1分钟）</span></div><div class="line">enron_hams, enron_spams = load_data_set(<span class="string">'enron_email'</span>)</div><div class="line">print(len(enron_hams), len(enron_spams))</div></pre></td></tr></table></figure></p>
<p>以enron_email数据为样本来训练，取2000个作为测试集，不参与训练。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">word_count</span><span class="params">(emails, test_fns=[])</span>:</span></div><div class="line">    <span class="string">""" 统计每个单词在邮件中出现的次数</span></div><div class="line"></div><div class="line">    :param emails: 所有邮件</div><div class="line">    :param test_fns: 测试用例的名字</div><div class="line">    :return: 单词出现的次数</div><div class="line">    """</div><div class="line">    _word_count = &#123;&#125;</div><div class="line">    <span class="keyword">for</span> _fn <span class="keyword">in</span> emails:</div><div class="line">        <span class="keyword">if</span> _fn <span class="keyword">in</span> test_fns.keys():</div><div class="line">            <span class="keyword">continue</span>  <span class="comment"># 排除测试用例</span></div><div class="line">        <span class="keyword">for</span> w <span class="keyword">in</span> emails[_fn]:</div><div class="line">            _word_count[w] = _word_count.get(w, <span class="number">0</span>) + <span class="number">1</span></div><div class="line">    <span class="keyword">return</span> _word_count</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">calc</span><span class="params">(email, _p_y1, _p_xi_y0, _p_xi_y1, _p_xi_y0_not_appear, _p_xi_y1_not_appear, is_use_not_appear=True)</span>:</span></div><div class="line">    <span class="string">""" 计算一个邮件是否是垃圾邮件</span></div><div class="line">    </div><div class="line">    :param email: 邮件内容，由单词组成的list</div><div class="line">    :param _p_y1: 样本中正常邮件所占的比率</div><div class="line">    :param _p_xi_y0: 每个单词在垃圾邮件中出现的概率</div><div class="line">    :param _p_xi_y1: 每个单词在正常邮件中出现的概率</div><div class="line">    :param _p_xi_y0_not_appear: 垃圾邮件中未出现过的词，给一个很小的概率</div><div class="line">    :param _p_xi_y1_not_appear: 正常邮件中未出现过的词，给一个很小的概率</div><div class="line">    :param is_use_not_appear: 是否使用未出现过的词，True表示使用</div><div class="line">    :return: 正常邮件与垃圾邮件概率的比值，大于1表示分类结果是正常邮件</div><div class="line">    """</div><div class="line">    rate = (_p_y1) / (<span class="number">1.0</span> - _p_y1)</div><div class="line">    <span class="keyword">for</span> w <span class="keyword">in</span> email:</div><div class="line">        <span class="keyword">if</span> is_use_not_appear == <span class="keyword">False</span> <span class="keyword">and</span> (w <span class="keyword">not</span> <span class="keyword">in</span> _p_xi_y1 <span class="keyword">or</span> w <span class="keyword">not</span> <span class="keyword">in</span> _p_xi_y0):</div><div class="line">            <span class="keyword">continue</span></div><div class="line">        rate *= _p_xi_y1.get(w, _p_xi_y0_not_appear) / _p_xi_y0.get(w, _p_xi_y1_not_appear)</div><div class="line">        </div><div class="line">    <span class="keyword">return</span> rate</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment"># 随机选取测试用例</span></div><div class="line">test_spam_count = <span class="number">2000</span>; test_ham_count = <span class="number">2000</span></div><div class="line">enron_test_ham_fns = dict(zip(random.sample(enron_hams.keys(), test_ham_count), [<span class="number">1</span>] * <span class="number">2000</span>))</div><div class="line">enron_test_spam_fns = dict(zip(random.sample(enron_spams.keys(), test_ham_count), [<span class="number">1</span>] * <span class="number">2000</span>))</div><div class="line"></div><div class="line"><span class="comment"># 统计每个单词分别在正常邮件、垃圾邮件中出现的次数</span></div><div class="line">enron_ham_word_count = word_count(enron_hams, enron_test_ham_fns)</div><div class="line">enron_spam_word_count = word_count(enron_spams, enron_test_spam_fns)</div><div class="line">print(len(enron_ham_word_count), len(enron_spam_word_count))</div><div class="line"></div><div class="line"><span class="comment"># 计算概率</span></div><div class="line">p_xi_y0 = &#123;&#125;; p_xi_y1 =&#123;&#125;</div><div class="line"><span class="keyword">for</span> w <span class="keyword">in</span> enron_ham_word_count:</div><div class="line">    p_xi_y1[w] = (enron_ham_word_count[w] + <span class="number">1.0</span>) / (len(enron_hams) + <span class="number">2.0</span>)  <span class="comment"># 单词xi在正常邮件中出现的概率</span></div><div class="line"><span class="keyword">for</span> w <span class="keyword">in</span> enron_spam_word_count:</div><div class="line">    p_xi_y0[w] = (enron_spam_word_count[w] + <span class="number">1.0</span>) / (len(enron_spams) + <span class="number">2.0</span>)  <span class="comment"># 单词xi在垃圾邮件中出现的概率</span></div><div class="line">p_y1 = float(len(enron_hams)) / float(len(enron_hams) + len(enron_spams))  <span class="comment"># 正常邮件的概率</span></div><div class="line">p_xi_y1_not_appear = <span class="number">1.0</span> / (<span class="number">2.0</span> + len(enron_spams))  <span class="comment"># 拉普拉斯平滑，给未见过的词一个很小的概率</span></div><div class="line">p_xi_y0_not_appear = <span class="number">1.0</span> / (<span class="number">2.0</span> + len(enron_hams))  <span class="comment"># 拉普拉斯平滑，给未见过的词一个很小的概率</span></div></pre></td></tr></table></figure></p>
<p>enron_email数据中取出的2000个测试集进行测试。可以看到成功率在98%以上。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 测试</span></div><div class="line">err_ham_count = <span class="number">0</span>; err_spam_count = <span class="number">0</span></div><div class="line"><span class="keyword">for</span> fn <span class="keyword">in</span> enron_test_ham_fns:</div><div class="line">    rate = calc(enron_hams[fn], p_y1, p_xi_y0, p_xi_y1, p_xi_y0_not_appear, p_xi_y1_not_appear)</div><div class="line">    <span class="keyword">if</span> rate &lt; <span class="number">1</span>:</div><div class="line">        err_ham_count += <span class="number">1</span></div><div class="line"></div><div class="line"><span class="keyword">for</span> fn <span class="keyword">in</span> enron_test_spam_fns:</div><div class="line">    rate = calc(enron_spams[fn], p_y1, p_xi_y0, p_xi_y1, p_xi_y0_not_appear, p_xi_y1_not_appear)</div><div class="line">    <span class="keyword">if</span> rate &gt;= <span class="number">1</span>:</div><div class="line">        err_spam_count += <span class="number">1</span></div><div class="line"></div><div class="line">print(<span class="string">'error ham: %s/%s (%.2f%%); error spam: %s/%s (%.2f%%)'</span> % \</div><div class="line">      (err_ham_count, test_ham_count, <span class="number">100.0</span> * err_ham_count / test_ham_count,\</div><div class="line">       err_spam_count, test_spam_count, <span class="number">100.0</span> * err_spam_count / test_spam_count))</div><div class="line"></div><div class="line"><span class="comment"># 忽略没有出现过的单词</span></div><div class="line">err_ham_count = <span class="number">0</span>; err_spam_count = <span class="number">0</span></div><div class="line"><span class="keyword">for</span> fn <span class="keyword">in</span> enron_test_ham_fns:</div><div class="line">    rate = calc(enron_hams[fn], p_y1, p_xi_y0, p_xi_y1, p_xi_y0_not_appear, p_xi_y1_not_appear, <span class="keyword">False</span>)</div><div class="line">    <span class="keyword">if</span> rate &lt; <span class="number">1</span>:</div><div class="line">        err_ham_count += <span class="number">1</span></div><div class="line"></div><div class="line"><span class="keyword">for</span> fn <span class="keyword">in</span> enron_test_spam_fns:</div><div class="line">    rate = calc(enron_spams[fn], p_y1, p_xi_y0, p_xi_y1, p_xi_y0_not_appear, p_xi_y1_not_appear, <span class="keyword">False</span>)</div><div class="line">    <span class="keyword">if</span> rate &gt;= <span class="number">1</span>:</div><div class="line">        err_spam_count += <span class="number">1</span></div><div class="line"></div><div class="line">print(<span class="string">'error ham: %s/%s (%.2f%%); error spam: %s/%s (%.2f%%)'</span> % \</div><div class="line">      (err_ham_count, test_ham_count, <span class="number">100.0</span> * err_ham_count / test_ham_count,\</div><div class="line">       err_spam_count, test_spam_count, <span class="number">100.0</span> * err_spam_count / test_spam_count))</div></pre></td></tr></table></figure></p>
<p>以上代码输出如下：<br><code>error ham: 11/2000 (0.55%); error spam: 27/2000 (1.35%)</code><br><code>error ham: 12/2000 (0.60%); error spam: 53/2000 (2.65%)</code></p>
<p>然后使用ling_email数据作为测试集来试试：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 加载ling_email数据</span></div><div class="line">ling_hams, ling_spams = load_data_set(<span class="string">'ling_email'</span>)</div><div class="line"></div><div class="line"><span class="comment"># 测试ling_email数据</span></div><div class="line">err_ling_ham_count = <span class="number">0</span>; err_ling_spam_count = <span class="number">0</span></div><div class="line"><span class="keyword">for</span> fn <span class="keyword">in</span> ling_hams:</div><div class="line">    rate = calc(ling_hams[fn], p_y1, p_xi_y0, p_xi_y1, p_xi_y0_not_appear, p_xi_y1_not_appear)</div><div class="line">    <span class="keyword">if</span> rate &lt; <span class="number">1</span>:</div><div class="line">        err_ling_ham_count += <span class="number">1</span></div><div class="line"></div><div class="line"><span class="keyword">for</span> fn <span class="keyword">in</span> ling_spams:</div><div class="line">    rate = calc(ling_spams[fn], p_y1, p_xi_y0, p_xi_y1, p_xi_y0_not_appear, p_xi_y1_not_appear)</div><div class="line">    <span class="keyword">if</span> rate &gt;= <span class="number">1</span>:</div><div class="line">        err_ling_spam_count += <span class="number">1</span></div><div class="line"></div><div class="line">print(<span class="string">'error ham: %s/%s (%.2f%%); error spam: %s/%s (%.2f%%)'</span> % \</div><div class="line">      (err_ling_ham_count, len(ling_hams), <span class="number">100.0</span> * err_ling_ham_count / len(ling_hams),\</div><div class="line">       err_ling_spam_count, len(ling_spams), <span class="number">100.0</span> * err_ling_spam_count / len(ling_spams)))</div><div class="line"></div><div class="line"><span class="comment"># 忽略没有出现过的单词</span></div><div class="line">err_ling_ham_count = <span class="number">0</span>; err_ling_spam_count = <span class="number">0</span></div><div class="line"><span class="keyword">for</span> fn <span class="keyword">in</span> ling_hams:</div><div class="line">    rate = calc(ling_hams[fn], p_y1, p_xi_y0, p_xi_y1, p_xi_y0_not_appear, p_xi_y1_not_appear, <span class="keyword">False</span>)</div><div class="line">    <span class="keyword">if</span> rate &lt; <span class="number">1</span>:</div><div class="line">        err_ling_ham_count += <span class="number">1</span></div><div class="line"></div><div class="line"><span class="keyword">for</span> fn <span class="keyword">in</span> ling_spams:</div><div class="line">    rate = calc(ling_spams[fn], p_y1, p_xi_y0, p_xi_y1, p_xi_y0_not_appear, p_xi_y1_not_appear, <span class="keyword">False</span>)</div><div class="line">    <span class="keyword">if</span> rate &gt;= <span class="number">1</span>:</div><div class="line">        err_ling_spam_count += <span class="number">1</span></div><div class="line"></div><div class="line">print(<span class="string">'error ham: %s/%s (%.2f%%); error spam: %s/%s (%.2f%%)'</span> % \</div><div class="line">      (err_ling_ham_count, len(ling_hams), <span class="number">100.0</span> * err_ling_ham_count / len(ling_hams),\</div><div class="line">       err_ling_spam_count, len(ling_spams), <span class="number">100.0</span> * err_ling_spam_count / len(ling_spams)))</div></pre></td></tr></table></figure></p>
<p>输出结果如下。<br><code>error ham: 574/2410 (23.82%); error spam: 13/481 (2.70%)</code><br><code>error ham: 283/2410 (11.74%); error spam: 14/481 (2.91%)</code></p>
<p>可以看到对垃圾邮件的识别还是可以的。但对正常邮件的识别效果不太好，如果考虑了没有出现过的单词，会将21%的正常邮件识别为垃圾邮件，如果不考虑没有出现过的单词，则会将11%的正常邮件识别为垃圾邮件。这里识别效果没那么好的原因可能是样本的数据集不够大，对测试集中单词的覆盖不完全。</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul>
<li>吴恩达老师机器学习视频</li>
<li>统计学习方法 李航</li>
<li>机器学习 周志华</li>
<li>机器学习实战</li>
</ul>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/机器学习/" rel="tag">#机器学习</a>
          
            <a href="/tags/朴素贝叶斯/" rel="tag">#朴素贝叶斯</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2016/11/27/machine_learning/logistic-regression/" rel="next" title="机器学习之逻辑回归">
                <i class="fa fa-chevron-left"></i> 机器学习之逻辑回归
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/02/20/machine_learning/svm/" rel="prev" title="支持向量机笔记">
                支持向量机笔记 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div class="ds-thread" data-thread-key="2016/12/06/machine_learning/naive-bayes/"
           data-title="机器学习之朴素贝叶斯" data-url="http://coder-ss.github.io/2016/12/06/machine_learning/naive-bayes/">
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="//schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/favicon.png"
               alt="coder-ss" />
          <p class="site-author-name" itemprop="name">coder-ss</p>
          <p class="site-description motion-element" itemprop="description">do something interesting</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">24</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">6</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">26</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">
            
              
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#生成式与判别式"><span class="nav-number">1.</span> <span class="nav-text">生成式与判别式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#朴素贝叶斯"><span class="nav-number">2.</span> <span class="nav-text">朴素贝叶斯</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#词集模型"><span class="nav-number">2.1.</span> <span class="nav-text">词集模型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#模型求解"><span class="nav-number">2.2.</span> <span class="nav-text">模型求解</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#拉普拉斯平滑"><span class="nav-number">3.</span> <span class="nav-text">拉普拉斯平滑</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#实践"><span class="nav-number">4.</span> <span class="nav-text">实践</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#参考资料"><span class="nav-number">5.</span> <span class="nav-text">参考资料</span></a></li></ol></div>
            
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">coder-ss</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.2"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.0.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.0.2"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.2"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"totoo"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    <script src="/vendors/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  






  
  

  
  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
  </script>

  <script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
      var all = MathJax.Hub.getAllJax(), i;
      for (i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
      }
    });
  </script>
  <script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>


  

  

  


</body>
</html>
